<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>gdb STL pretty printer | ongoing's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>gdb STL pretty printer</span></h1><h2 class=date>2020/11/05</h2></div><main><blockquote><p>GDB = not easy to learn, but easy to use
=)</p></blockquote><p>gdb在打印普通变量时会有很好的作用，但是有时想要打印stl中的容器时，返回i的信息却并不怎么友好。</p><p>例如在打印一个<code>map&lt;int, int> mp;</code>中的变量<code>mp</code>时，在gdb中使用<code>print mp</code>返回的是如下的结果</p><img src=pretty_printer_1.png alt><p>这样的信息很杂，而一般在debug中重要的几点就是</p><ol><li>容器中元素个数</li><li>容器中元素值</li><li>容器元素类型</li><li>&mldr;</li></ol><p>而上面这几项在返回的信息中很难寻找。</p><p>经过一番搜索，我发现在gdb中可以使用python语言脚本，以及gdb内置的有一个名为<code>pretty printer</code>的东西，这个东西可以使得在gdb中打印容器时返回的信息是<strong>非常友好</strong>的！</p><p>这是一篇关于gdb pretty printer的 <a href=https://sourceware.org/gdb/wiki/STLSupport target=_blank rel="noopener noreferrer">GDB wiki STL support</a>，里边有三种方式，这里展示的是第一种方法。</p><p>下面的是具体的实现步骤，经过这些步骤我们再次在gdb中打印容器时，返回的就不是一大堆杂乱的信息，而是一些重要的信息，如下</p><img src=pretty_printer_2.png alt><p>对不对，这样的信息是不是就清晰明了的许多呢？如同在ide中debug一样，并且不用使用鼠标点来点去，非常方便。</p><h4 id=使用svn下载一个官方仓库>使用<code>SVN</code>下载一个官方仓库</h4><ol><li><p>先自己创建一个文件夹存放这个仓库，例如存放在<code>~/.gdb</code>下</p><pre tabindex=0><code>mkdir ~/.gdb
</code></pre></li><li><p>在本文件夹下执行如下命令
<em>如果没有svn，则需要先安装 Install svn(ubuntu) =</em> <code>sudo apt-get install subversion</code></p><pre tabindex=0><code>svn co svn =//gcc.gnu.org/svn/gcc/trunk/libstdc++-v3/python
</code></pre><p>这条命令执行完毕后会发现<code>~/.gdb</code>目录下多了一个<code>python</code>文件夹。</p></li><li><p>在<code>~/.gdbinit</code>文件中书写如下内容(<code>.gdbinit</code>文件如不存在则自行创建)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python
</span></span><span style=display:flex><span>import sys
</span></span><span style=display:flex><span>sys.path.insert<span style=color:#f92672>(</span>0, <span style=color:#e6db74>&#39;python文件夹的绝对路径&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>from libstdcxx.v6.printers import register_libstdcxx_printers
</span></span><span style=display:flex><span>register_libstdcxx_printers <span style=color:#f92672>(</span>None<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set print pretty on <span style=color:#75715e># 使格式更加美观</span>
</span></span></code></pre></div><p><em>注：第三行中的路径需要根据自己clone下的python自行设定，例如如果根据我前面设定的就是<code>$HOME/.gdb/python</code></em>(这里的<code>$HOME</code>自行echo $HOME查看下)</p></li></ol><p>经过这两步后重新启动gdb即可。</p><p>当然也可以自己书写python脚本对gdb进行各种设置，这样会更加贴切自己的使用体验。</p></main><script>document.addEventListener("DOMContentLoaded",function(){const e=new PhotoSwipeLightbox({gallery:".pswp-gallery",children:"a",pswpModule:PhotoSwipe});e.init()})</script>