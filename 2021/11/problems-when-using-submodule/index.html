<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>使用 submodule 遇到的一些坑 | ongoing's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>使用 submodule 遇到的一些坑</span></h1><h2 class=date>2021/11/04</h2></div><main><p>前言：平时使用的一些常用的脚本以及常用组件如果在不同项目之间复制粘贴不易维护，所以把这些常使用的组件维护为一个仓库，其他项目在使用时把这个仓库添加为子模块 (submodule)，这样的话，易用性和维护性都有了提升。</p><p>下面是我在使用过程中遇到的两个坑点。</p><img src=app_and_submodule.png alt><h3 id=第一个坑>第一个坑</h3><p>我的错误做法 = 在仓库里添加了子模块后，子模块的仓库会被 clone 到当前仓库中。使用<code>git status</code>会发现我们的子模块被添加到了 git 的缓冲区了，我之前不想让它加入缓冲区，就在仓库的 .gitignore 中添加了排除子模块的语句，之后 git push 就不能使用了。尝试重新生成 ssh key，但依旧没有起作用。</p><p>解决：之后在 .gitignore 中删除了之前添加了忽略子模块的语句后，git push 就可以重新使用了。</p><h3 id=第二个坑>第二个坑</h3><p>之前说过在 add submodule 后，子模块会被加到 git 的缓冲区中，类似下图中的黄色字体</p><img src=submodule.png alt="使用 git submodule add 后 可以发现缓存区多了两项"><p>因为当时我还有其他更改需要进行 commit，就使用 <code>git rm --cached 子模块</code>，把子模块从缓冲区中删除掉了，这个命令执行之后，我的 git push 再次不能不能使用了 (O x O)。</p><p><strong>并且这个时候使用 git add 把子模块重新加载到缓冲区会有问题。</strong></p><p>所以再次使用 git submodule add 子模块 url 命令将子模块再次添加到仓库中，这个命令执行完毕后，我们可以再次看到子模块又出现在了 git 缓冲区中。因为这个就是需要提交到远程仓库的，commit 之后 push，可以在 github 仓库中看到这样的图标：</p><img src=submodule-id.png alt><p>之后把常用的组件直接拷贝到子模块里，项目里想使用的话直接去进行拉取，并且子模块的分支使用也很灵活。</p><h2 id=关于子仓库的使用>关于子仓库的使用</h2><p>当我们克隆了一个带有 submodule 的仓库后，克隆完主仓库后，子仓库是没有代码的，只能在主仓库
根目录下看到一个空的子仓库文件夹。如果我们也想要克隆子仓库的话，那么需要以下两步：</p><h3 id=初始化子仓库>初始化子仓库</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git submodule init
</span></span></code></pre></div><h3 id=克隆子仓库>克隆子仓库</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gitsubmoduleTupdate+08 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;00&#39;</span>
</span></span></code></pre></div><p>现在我们就可以在子仓库中看到代码了。😎</p></main><script>document.addEventListener("DOMContentLoaded",function(){const e=new PhotoSwipeLightbox({gallery:".pswp-gallery",children:"a",pswpModule:PhotoSwipe});e.init()})</script>