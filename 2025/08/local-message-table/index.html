<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>本地消息表 | ongoing's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>本地消息表</span></h1><h2 class=date>2025/08/25</h2></div><main><h3 id=一背景>一、背景</h3><p>将要发送到外部系统的消息和自己本地的业务数据，放在同一个数据库事务里进行保存。</p><p>通过这种方式，本地业务操作和消息的存储具备了 原子性：</p><p>成功：业务数据和消息同时被存入数据库。</p><p>失败：业务数据和消息同时回滚，仿佛发送消息的操作从未发生过。</p><p>暂存，先保存，后处理。</p><p>这很像是登记任务后，后台异步任务处理而已。</p><p>其实之前像是异步登记的任务，差不多都是这种模式的，只要用户对于实时性不是那么的高。</p><h3 id=二流程>二、流程</h3><img src=spring_process-local_message_table.svg alt><h3 id=三独立消息服务>三、独立消息服务</h3><p>除了本地消息外，还有使用消息中间件的独立服务。这个更加专业，性能也更好。消息和业务分开。</p></main><script>document.addEventListener("DOMContentLoaded",function(){const e=new PhotoSwipeLightbox({gallery:".pswp-gallery",children:"a",pswpModule:PhotoSwipe});e.init()})</script>