<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>dependentBeanMap and dependenciesForBeanMap | ongoing's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>dependentBeanMap and dependenciesForBeanMap</span></h1><h2 class=date>2025/04/23</h2></div><main><h3 id=一背景>一、背景</h3><p>在<code>org.springframework.beans.factory.support.DefaultSingletonBeanRegistry</code>看到这两个变量</p><ul><li><code>dependentBeanMap</code>: 本bean是其他bean的外部依赖，本bean是底层，别的bean需要本bean才能活下去。</li><li><code>dependenciesForBeanMap</code>: 外部依赖，本bean依赖于外部依赖。</li></ul><h3 id=二结构>二、结构</h3><p>依赖关系如下图所示</p><img src=dependent_bean_and_dependency_bean.png alt><h4 id=dependentbeanmap反向依赖->dependentBeanMap(反向依赖 &lt;&ndash;)</h4><ol><li><p>存放的是<code>dependent bean</code></p></li><li><p>结构</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String, Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> dependentBeanMap <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;beanA&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;beanB&#34;</span>, <span style=color:#e6db74>&#34;beanC&#34;</span><span style=color:#f92672>]</span>,  <span style=color:#75715e>// beanB, beanC 依赖 beanA</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;beanB&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;beanD&#34;</span><span style=color:#f92672>]</span> <span style=color:#75715e>// beanD 依赖 beanB</span>
</span></span><span style=display:flex><span>}; 
</span></span></code></pre></div></li><li><p>当 bean 被销毁时，通过 dependentBeanMap 找到依赖它的所有 bean，触发这些 bean 的销毁。</p></li></ol><h4 id=dependenciesforbeanmap正向依赖->dependenciesForBeanMap(正向依赖 &ndash;>)</h4><ol><li><p>存放的是<code>dependency bean</code></p></li><li><p>结构</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Map<span style=color:#f92672>&lt;</span>String, Set<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;&gt;</span> dependenciesForBeanMap <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;beanB&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;beanA&#34;</span><span style=color:#f92672>]</span>,  <span style=color:#75715e>// beanB 依赖 beanA</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;beanC&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;beanA&#34;</span><span style=color:#f92672>]</span>,  <span style=color:#75715e>// beanC 依赖 beanA</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;beanD&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;beanB&#34;</span><span style=color:#f92672>]</span>   <span style=color:#75715e>// beanD 依赖 beanB</span>
</span></span><span style=display:flex><span>}; 
</span></span></code></pre></div></li><li><p>初始化 bean 阶段，根据这个 map 确认依赖是否已经就绪，因为需要确保依赖先就绪，再初始化本 bean</p></li></ol><h3 id=三dependent-bean>三、dependent bean</h3><p>那么<code>dependent bean</code>的中文释义是如何翻译的呢？</p><p>依赖者。就是依赖某个bean的bean。</p><p>dependency: 被依赖者。
例如项目pom文件中那些外部的依赖包，它们都是被依赖者，本项目依赖外部的那些依赖，它们不会依赖于本项目。</p></main><script>document.addEventListener("DOMContentLoaded",function(){const e=new PhotoSwipeLightbox({gallery:".pswp-gallery",children:"a",pswpModule:PhotoSwipe});e.init()})</script>