<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Threadpool | ongoing's blog</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/fonts.css></head><body><nav><ul class=menu><li><a href=/>首页</a></li><li><a href=/categories/>分类</a></li><li><a href=/about/>关于</a></li></ul><hr></nav><div class=article-meta><h1><span class=title>Threadpool</span></h1><h2 class=date>2023/06/18</h2></div><main><h3 id=一前言>一、前言</h3><p>线程池在我们日常开发中扮演着重要的角色。</p><ul><li>管理线程的创建和销毁，不需要开发者关系如何运作</li></ul><p><code>keepAliveTime</code>: 为了释放多余的线程资源。非核心线程，空闲时有一个最长等待时间，就是 keepAliveTime，时间到了没有任务，会被终止。</p><p>优点：</p><ol><li>可以重用线程，避免线程创建的开销</li><li>任务过多时，通过排队避免创建过多线程，减少系统资源消耗</li></ol><h3 id=二涉及方法>二、涉及方法</h3><h4 id=sleep-与-yield>sleep() 与 yield()</h4><ol><li><p>sleep()
不会事线程丢失监视器所有权，当前线程仍然占用 CPU 分片。
可读性更好的写法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>TimeUnit.<span style=color:#a6e22e>SECONDS</span>.<span style=color:#a6e22e>sleep</span>(1);
</span></span></code></pre></div></li><li><p>yield() 让步
线程让步。
对线程调度器发出一个暗示，当前线程愿意让出使用的处理器。
调用此方法后，状态可能由 running 状态转为 runnable 状态。</p></li><li><p>thread.join()
表示无限等待，一直阻塞当前线程，直到目标线程执行完毕。
通常是加入的意思，一个线程要加入到另外一个线程，最好是等着它一起走。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    threadA.<span style=color:#a6e22e>join</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>main 线程等待 threadA 执行完毕。</p></li></ol><h3 id=三守护线程-daemon>三、守护线程 (Daemon)</h3><p>相当于闭馆后最后一个锁大门的管理者。</p><h3 id=四注意>四、注意</h3><ol><li><p>线程池中，核心线程和最大线程是否有特殊标记？</p><p>没有，无论是核心线程还是非核心线程，在线程池中都一样，当淘汰的时候，不关心是哪些线程，只需要留下核心线程数量个线程即可。</p></li><li><p>线程数小于核心线程数，并且线程都处于空闲状态，现在提交一个任务，是新起一个线程还是给之前创建的线程运行？</p><p>execute 方法的注释中写道，<code>If fewer than corePoolSize threads are running, try to start a new thread with the given command as its first task</code>. 从注释可以知道，此时线程池会新起一个线程来运行新任务，不管老线程是否空闲。</p></li></ol></main><script>document.addEventListener("DOMContentLoaded",function(){const e=new PhotoSwipeLightbox({gallery:".pswp-gallery",children:"a",pswpModule:PhotoSwipe});e.init()})</script>